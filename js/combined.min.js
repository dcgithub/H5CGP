/**
 * HTML5 Canvas Game Boilerplate 2.2.1-14072019
 * Certain components copyright their respective authors.
 *
 * @author Isaac Sukin (http://www.isaacsukin.com/)
 * @license [object Object] License
 * @ignore
 */

!function(c){function t(t){if("string"==typeof t.data){var r=t.handler,h=t.data.toLowerCase().split(" ");t.handler=function(t){if(this===t.target||!(/textarea|select/i.test(t.target.nodeName)||-1<c.inArray(t.target.type,c.hotkeys.textTypes))){var i="keypress"!==t.type&&c.hotkeys.specialKeys[t.which],e=String.fromCharCode(t.which).toLowerCase(),s="",n={},a,o;for(t.altKey&&"alt"!==i&&(s+="alt+"),t.ctrlKey&&"ctrl"!==i&&(s+="ctrl+"),t.metaKey&&!t.ctrlKey&&"meta"!==i&&(s+="meta+"),t.shiftKey&&"shift"!==i&&(s+="shift+"),i?n[s+i]=!0:(n[s+e]=!0,n[s+c.hotkeys.shiftNums[e]]=!0,"shift+"===s&&(n[c.hotkeys.shiftNums[e]]=!0)),"keydown"===t.type?(o=i||e,(void 0===(a=c.inArray(o,c.hotkeys.keysDown))||a<0)&&c.hotkeys.keysDown.push(o)):"keyup"===t.type&&(o=i||e,void 0!==(a=c.inArray(o,c.hotkeys.keysDown))&&-1<a&&c.hotkeys.keysDown.splice(a,1),c.hotkeys.lastKeysPressed.push(o),5<c.hotkeys.lastKeysPressed.length&&c.hotkeys.lastKeysPressed.shift()),a=0,l=h.length;a<l;a++)if(n[h[a]])return t.keyPressed=h[a],r.apply(this,arguments)}}}}c.hotkeys={version:"0.9",keysDown:[],lastKeysPressed:[],textTypes:["text","search","tel","url","email","password","number","range","date","month","week","time","datetime","datetime-local","color"],specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"},areKeysDown:function(t){var i;if("string"==typeof t){var e=t.split(" ");for(i=0;i<e.length;i++)if(this.areKeysDown(e[i].split("+")))return!0;return!1}var s=!1,n=this.keysDown.length;if(n!=t.length)return!1;for(i=0;i<n;i++)if(-1<c.inArray(this.keysDown[i],["alt","ctrl","meta","shift"])){s=!0;break}if(s){for(i=0;i<n;i++)if(-1==c.inArray(this.keysDown[i],t))return!1}else for(i=0;i<n;i++)if(this.keysDown[i]!=t[i])return!1;return!0},lastKeyPressed:function(){return this.lastKeysPressed[this.lastKeysPressed.length-1]}},c.each(["keydown","keyup","keypress"],function(){c.event.special[this]={add:t}}),c(document).keydown("na",function(){}),c(document).keyup("na",function(){})}(this.jQuery),function(){var a=!1,o=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(t){var n=this.prototype;a=!0;var i=new this;for(var e in a=!1,t)i[e]="function"==typeof t[e]&&"function"==typeof n[e]&&o.test(t[e])?function(e,s){return function(){var t=this._super;this._super=n[e];var i=s.apply(this,arguments);return this._super=t,i}}(e,t[e]):t[e];function s(){!a&&this.init&&this.init.apply(this,arguments)}return((s.prototype=i).constructor=s).extend=arguments.callee,s}}(),function(){function t(t,e,i){var s="function"==typeof i.postInitCallback?i.postInitCallback:null,n=this;i.postInitCallback=function(t){for(var i in n.sprite=t,n.baseImage=t.image,n.cachedImages={"00":n.baseImage},n.maps={},e)e.hasOwnProperty(i)&&n.set(i,e[i]);s&&s.apply(this,arguments)},this.sprite=new Sprite(t,i),this.sprite.spriteMap=this}t.prototype={set:function(t,i){i instanceof Array&&(i={startRow:i[0],startCol:i[1],endRow:i[2],endCol:i[3],squeeze:i[4],flipped:i[5]}),this.maps[t]={startRow:void 0!==i.startRow?i.startRow:0,startCol:void 0!==i.startCol?i.startCol:0,endRow:void 0!==i.endRow?i.endRow:this.sprite.rows-1,endCol:void 0!==i.endCol?i.endCol:this.sprite.cols-1,squeeze:void 0!==i.squeeze&&i.squeeze,flipped:void 0!==i.flipped?i.flipped:{horizontal:!1,vertical:!1}};var e=this.maps[t].flipped,s=(e.horizontal?"1":"0")+(e.vertical?"1":"0");return void 0===this.sprite.cachedImages[s]&&(this.sprite.cachedImages[s]=this.sprite._prerender(this.baseImage,e)),this},unset:function(t){return this.maps.hasOwnProperty(t)&&delete this.maps[t],this},use:function(t,i){if(this.activeLoop==t&&!i)return this;this.activeLoop=t;var e=this.maps[t];return this.sprite.setLoop(e.startRow,e.startCol,e.endRow,e.endCol,e.squeeze,e.flipped),this},start:function(t){return t&&this.use(t),this.sprite.startLoop(),this},stop:function(){return this.sprite.stopLoop(),this},reset:function(){return this.sprite.reset(),this},runOnce:function(t,i){return i&&this.use(i),this.sprite.runLoop(t),this},draw:function(t,i,e,s,n){return this.sprite.draw(t,i,e,s,n),this},clone:function(){return new t(this.sprite.sourceFile,this.maps,this.sprite)}},this.SpriteMap=t}.call(this),function(){function o(t,i){if("string"==typeof t){this.sourceFile=t;var e=o.getImageFromCache(t);if(e)this._init(e,i);else{var s=new Image,n=this;s.onload=function(){n._init(this,i)},s._src=t,s.src=t,o.saveImageToCache(t,s)}}else if(t instanceof HTMLImageElement||t instanceof Image){if(!t.src)return;if(this.sourceFile=t._src||t.src,t.complete||t.width&&t.height)o.saveImageToCache(this.sourceFile,t),this._init(t,i);else{if(t._src)return;var a=t.onload,n=this;t.onload=function(){"function"==typeof a&&a(),o.saveImageToCache(n.sourceFile,t),n._init(this,i)}}}else t instanceof HTMLCanvasElement&&this._init(t,i)}o.prototype={_init:function(t,i){this.width=t.width,this.height=t.height,this.frameW=i.frameW||t.width,this.frameH=i.frameH||t.height,this.projectedW=i.projectedW||this.frameW,this.projectedH=i.projectedH||this.frameH,this.rows=Math.floor(this.height/this.frameH),this.cols=Math.floor(this.width/this.frameW),this.startRow=i.startRow||0,this.startCol=i.startCol||0,this.endRow=void 0===i.endRow?this.rows-1:i.endRow,this.endCol=void 0===i.endCol?this.cols-1:i.endCol,this.row=this.startRow,this.col=this.startCol,this.frame=1,this.squeeze=i.squeeze||!1,this.interval=void 0===i.interval?125:i.interval,this.useTimer=void 0===i.useTimer||i.useTimer,this.advanceFramesManually=i.advanceFramesManually||!1,this.lastFrameUpdateTime=0,this.flipped=i.flipped||{horizontal:!1,vertical:!1},this.flipped.horizontal=this.flipped.horizontal||!1,this.flipped.vertical=this.flipped.vertical||!1,this.cachedImages={"00":t};var e=this.flipped,s=(e.horizontal?"1":"0")+(e.vertical?"1":"0");void 0===this.cachedImages[s]&&(this.cachedImages[s]=this._prerender(t,e)),this.image=this.cachedImages[s],this._runOnce=!1,this.squeeze&&(this.cols=this.endCol-this.startCol+1),this.numFrames=this.getNumFrames(),i.postInitCallback&&i.postInitCallback(this)},_prerender:function(t,i){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var s=e.getContext("2d");return(i.horizontal||i.vertical)&&(s.translate(i.horizontal?e.width:0,i.vertical?e.height:0),s.scale(i.horizontal?-1:1,i.vertical?-1:1)),s.drawImage(t,0,0),e},draw:function(t,i,e,s,n){try{t.save(),s=s||this.projectedW,n=n||this.projectedH;var a=this.col*this.frameW,o=this.row*this.frameH;this.flipped.horizontal&&(a=this.width-a-this.frameW),this.flipped.vertical&&(o=this.height-o-this.frameH),t.drawImage(this.image,a,o,this.frameW,this.frameH,i,e,s,n),t.restore()}catch(t){console&&console.error&&console.error(t)}return!this.useTimer&&!this.advanceFramesManually&&Date.now()-this.lastFrameUpdateTime>this.interval&&this.nextFrame(),this},reset:function(){return this.row=this.startRow,this.col=this.startCol,this.frame=1,this.lastFrameUpdateTime=0,this},changeFrame:function(t){return this.frame+=t,this.setFrame(this.frame),this},setFrame:function(t,i){if(void 0!==i)this.row=t,this.col=i,this.squeeze?this.frame=this.cols*(this.row-this.startRow+1)-(this.endCol-this.col):this.frame=this.cols*(this.row-this.startRow+1)-(this.cols-(this.col+1))-this.startCol;else{var e=this.frameNumberToRowCol(t);this.frame=e.frame,this.row=e.row,this.col=e.col}return this.lastFrameUpdateTime=Date.now(),this},setLoop:function(t,i,e,s,n,a){if(this.stopLoop(),null==e&&(e=this.rows-1),null==s&&(s=this.cols-1),void 0!==n&&(this.squeeze=n),void 0!==a){this.flipped=a;var o=this.flipped,r=(o.horizontal?"1":"0")+(o.vertical?"1":"0");void 0===this.cachedImages[r]&&(this.cachedImages[r]=this._prerender(this.image,o)),this.image=this.cachedImages[r]}return this.startRow=t,this.startCol=i,this.endRow=e,this.endCol=s,this.reset(),this.numFrames=this.getNumFrames(),this},startLoop:function(t,i,e,s,n,a){if(void 0!==t&&void 0!==i&&this.setLoop(t,i,e,s,n,a),this.lastFrameUpdateTime=Date.now(),this.interval&&this.useTimer){var o=this;this.intervalID=setInterval(function(){o.nextFrame()},this.interval)}return this},stopLoop:function(){return this.lastFrameUpdateTime=0,this.intervalID&&clearInterval(this.intervalID),this},runLoop:function(t,i,e,s,n,a,o){return this.runLoopCallback=t||function(){},this._runOnce=!0,Array.prototype.shift.call(arguments),this.startLoop.apply(this,arguments),this},prevFrame:function(){return changeFrame(-1),this},nextFrame:function(){return this.col++,this.frame++,this.row==this.endRow&&this.col>this.endCol?this._runOnce?(this.stopLoop(),this._runOnce=!1,this.runLoopCallback(this)):this.reset():this.squeeze&&this.col>this.endCol?(this.col=this.startCol,this.row++):!this.squeeze&&this.col>=this.cols&&(this.col=0,this.row++),this.lastFrameUpdateTime=Date.now(),this},getFrame:function(){return{row:this.row,col:this.col,frame:this.frame}},getNumFrames:function(){return this.squeeze?(this.endRow-this.startRow+1)*(this.endCol-this.startCol+1):(this.endRow-this.startRow)*this.cols-this.startCol+this.endCol+1},frameNumberToRowCol:function(t){var i,e;return t=(t+this.numFrames)%this.numFrames||this.numFrames,e=this.squeeze?(i=this.startRow+Math.floor((t-1)/this.cols),(t-1)%this.cols+this.startCol):(i=this.startRow+Math.floor((t+this.startCol-1)/this.cols),(t+this.startCol-1)%this.cols),{frame:t,row:i,col:e}},clone:function(){return new o(this.sourceFile,this)}},this.Sprite=o}.call(this),function(){var e={};Sprite.getImageFromCache=function(t){return e[t]?e[t]:null},Sprite.saveImageToCache=function(t,i){e[t]=i},Sprite.preloadImages=function(t,e){var s=t.length,n=-1,i,a,o=function(t,i){n++,"function"==typeof t&&t(i,n,s),n==s&&"function"==typeof e.finishCallback&&e.finishCallback(s)};o();for(var r=function(){Sprite.saveImageToCache(this._src,this),o(e.itemCallback,this._src)};t.length;)i=t.pop(),(a=new Image)._num=s-t.length,a._src=i,a.onload=r,a.src=i}}.call(this);var App={},canvas,$canvas,context,world;App.isGameOver=!1,App.debugMode=!1,App.MIN_FPS=4,App.MAX_FPS=100,App.physicsTimeElapsed=0,App.physicsDelta=0,App.Debug={},App.Debug.updateTimeElapsed=0,App.Debug.clearTimeElapsed=0,App.Debug.drawTimeElapsed=0,App.setCanvas=function(t){if("string"==typeof t){var i=t;(t=document.getElementById(t))instanceof HTMLCanvasElement||!window.console||!console.warn||console.warn("No canvas with ID "+i+" found.")}if(t instanceof HTMLCanvasElement)void 0!==world&&(context.translate(world.xOffset,world.yOffset),world.scaleResolution(1)),canvas=t,$canvas=jQuery(canvas),App.beforeSetup();else{if(canvas instanceof HTMLCanvasElement&&void 0!==$canvas)return;if(!((canvas=document.getElementById("canvas"))instanceof HTMLCanvasElement))for(var e=0,s=document.getElementsByTagName("canvas"),n=s.length;e<n;e++)if("false"!=s[e].getAttribute("data-takeover")){canvas=s[e];break}canvas instanceof HTMLCanvasElement||(canvas=document.createElement("canvas")),$canvas=jQuery(canvas),App.isSetup?App.beforeSetup():jQuery(window).load(App.beforeSetup)}},jQuery(document).ready(App.setCanvas),App.beforeSetup=function(){if(App.isSetup=!0,"undefined"!=typeof keys)for(var t in keys)keys.hasOwnProperty(t)&&App.preventDefaultKeyEvents(keys[t].join(" "));App.setDefaultCanvasSize(),context=canvas.getContext("2d"),"undefined"!=typeof Stats&&App.debugMode&&(App.stats=new Stats,App.stats.setMode(0),App.stats.domElement.style.position="absolute",App.stats.domElement.style.left=$canvas.offset().left,App.stats.domElement.style.top=$canvas.offset().top,document.body.appendChild(App.stats.domElement)),Caches.preloadImages("undefined"==typeof preloadables?[]:preloadables,{finishCallback:function(){"undefined"==typeof Events&&void 0!==App.Events&&(Events=App.Events),"undefined"==typeof Utils&&void 0!==App.Utils&&(Utils=App.Utils),App.reset(!0)}})},App.reset=function(t){stopAnimating(),App.isSomethingBeingDragged&&(App.isSomethingBeingDragged=!1,jQuery(document).trigger("canvasdragstop")),void 0!==world&&(context.translate(world.xOffset,world.yOffset),world.scaleResolution(1)),world=new World,context.__layer=world,App.timer=new Timer(!1),App.timer.frames=0,App.isGameOver=!1,App.physicsTimeElapsed=0,App.Debug.updateTimeElapsed=0,App.Debug.clearTimeElapsed=0,App.Debug.drawTimeElapsed=0;var i=setup(!!t);Timer.event("app start"),!1!==i&&startAnimating(),jQuery(document).trigger("start",[!!t])},App.setDefaultCanvasSize=function(){var t=function(){$canvas.css({transform:"scale3d(1, 1, 1)",mozTransform:"scale3d(1, 1, 1)",msTransform:"scale3d(1, 1, 1)",oTransform:"scale3d(1, 1, 1)",webkitTransform:"scale3d(1, 1, 1)"})};if("false"==$canvas.attr("data-resize"))return t(),void 0;var i=jQuery(window);if("full"==$canvas.attr("data-resize"))canvas.width=i.innerWidth()-parseInt($canvas.css("border-left-width"),10)-parseInt($canvas.css("border-right-width"),10)-1,canvas.height=i.innerHeight()-parseInt($canvas.css("border-top-width"),10)-parseInt($canvas.css("border-bottom-width"),10)-1;else{var e=$canvas.attr("data-maxwidth")||canvas.width,s=$canvas.attr("data-minwidth")||canvas.width;canvas.width=Math.min(e,Math.max(i.width(),s));var n=$canvas.attr("data-maxheight")||canvas.height,a=$canvas.attr("data-minheight")||canvas.height;canvas.height=Math.min(n,Math.max(i.height(),a))}var o=$canvas.attr("data-aspectratio")||0;o&&(-1==o.indexOf(":")?o=parseFloat(o):"4:3"==o?o=4/3:"16:9"==o?o=16/9:"16:10"!=o&&"8:5"!=o||(o=1.6),canvas.width<canvas.height*o?canvas.height=Math.floor(canvas.width/o):canvas.width>canvas.height*o&&(canvas.width=Math.floor(canvas.height*o))),t()};var Caches={images:{},imagePatterns:{},preloadImages:function(t,e){var s=t.length,n=-1,i,a,o=function(t,i){n++,"function"==typeof t&&t(i,n,s),n==s&&"function"==typeof e.finishCallback&&e.finishCallback(s)};o();for(var r=function(){Caches.images[this._src]=this,o(e.itemCallback,this._src)};t.length;)i=t.pop(),(a=new Image)._num=s-t.length,a._src=i,a.onload=r,a.src=i}};function Timer(t,i){this.autoStart=void 0===t||t,this.whileAnimating=i||!1,this.lastStartTime=0,this.lastDeltaTime=0,this.elapsedTime=0,this.running=!1,this.getDelta=function(){var t=0;if(this.running){var i=this.whileAnimating?App.physicsTimeElapsed:performance.now();t=(i-this.lastDeltaTime)/1e3,this.lastDeltaTime=i,this.elapsedTime+=t}return t},this.start=function(){this.running||(this.lastStartTime=this.lastDeltaTime=this.whileAnimating?App.physicsTimeElapsed:performance.now(),this.running=!0)},this.stop=function(){this.elapsedTime+=this.getDelta(),this.running=!1},this.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},this.autoStart&&this.start()}function World(t,i){this.scale=1,this._actualXscale=1,this._actualYscale=1,this.width=t||parseInt($canvas.attr("data-worldwidth"),10)||canvas.width,this.height=i||parseInt($canvas.attr("data-worldheight"),10)||canvas.height,this.originalCanvasWidth=canvas.width,this.originalCanvasHeight=canvas.height,this.xOffset=(this.width-canvas.width)/2,this.yOffset=(this.height-canvas.height)/2,context.translate(-this.xOffset,-this.yOffset),this.resize=function(t,i){var e=(t-this.width)/2,s=(i-this.height)/2;this.xOffset+=e,this.yOffset+=s,context.translate(-e,-s),this.width=t,this.height=i,jQuery(document).trigger("resizeWorld",[e,s,this])},this.scaleResolution=function(t,i,e){$canvas.hasClass("canvas-rescaled")||($canvas.css({width:canvas.width+"px",height:canvas.height+"px"}),$canvas.addClass("canvas-rescaled")),i=i||this.xOffset+canvas.width/2,e=e||this.yOffset+canvas.height/2,canvas.width=Math.round(this.originalCanvasWidth*t),canvas.height=Math.round(this.originalCanvasHeight*t),this._actualXscale=canvas.width/this.originalCanvasWidth,this._actualYscale=canvas.height/this.originalCanvasHeight,this.xOffset=Math.round(Math.min(this.width-canvas.width,Math.max(0,i-canvas.width/2))),this.yOffset=Math.round(Math.min(this.height-canvas.height,Math.max(0,e-canvas.height/2))),context.translate(-this.xOffset,-this.yOffset),this.scale=t,isAnimating()||draw()},this.canvasToWorldPosition=function(t,i){return{x:t*this._actualXscale+this.xOffset,y:i*this._actualYscale+this.yOffset}},this.worldToCanvasPosition=function(t,i){return{x:(t-this.xOffset)/this._actualXscale,y:(i-this.yOffset)/this._actualYscale}},this.centerViewportAround=function(t,i){var e=0|Math.min(this.width-canvas.width,Math.max(0,t-canvas.width/2)),s=0|Math.min(this.height-canvas.height,Math.max(0,i-canvas.height/2)),n=this.xOffset-e,a=this.yOffset-s;this.xOffset=e,this.yOffset=s,context.translate(n,a)},this.isInView=function(t,i){return i?t.x+t.width>this.xOffset&&t.x<this.xOffset+canvas.width&&t.y+t.height>this.yOffset&&t.y<this.yOffset+canvas.height:t.x>this.xOffset&&t.x+t.width<this.xOffset+canvas.width&&t.y>this.yOffset&&t.y+t.height<this.yOffset+canvas.height},this.isInWorld=function(t,i){return i?0<=t.x+t.width&&t.x<=world.width&&0<=t.y+t.height&&t.y<=world.height:0<=t.x&&t.x+t.width<=world.width&&0<=t.y&&t.y+t.height<=world.height}}function Layer(t){t=t||{},this.canvas=t.canvas||document.createElement("canvas"),this.context=this.canvas.getContext("2d"),(this.context.__layer=this).width=t.width||(t.canvas?t.canvas.width:0)||("canvas"==t.relative?canvas.width:world.width),this.height=t.height||(t.canvas?t.canvas.height:0)||("canvas"==t.relative?canvas.height:world.height),this.x=t.x||0,this.y=t.y||0,this.relative=t.relative||"world",this.opacity=t.opacity||1,this.parallax=t.parallax||1,this.canvas.width!=this.width&&(this.canvas.width=this.width),this.canvas.height!=this.height&&(this.canvas.height=this.height),this.xOffset=0,this.yOffset=0,t.src&&this.context.drawImage(t.src,0,0,this.width,this.height),this.draw=function(t,i,e){return t instanceof CanvasRenderingContext2D||(e=i,i=t,t=context),i=void 0===i?this.x:i,e=void 0===e?this.y:e,t.save(),t.globalAlpha=this.opacity,"canvas"==this.relative&&t.translate(world.xOffset,world.yOffset),(this.xOffset||this.yOffset)&&t.translate(this.xOffset,this.yOffset),t.drawImage(this.canvas,i,e),t.restore(),this},this.clear=function(t){return this.context.clear(t),this},this.scroll=function(t,i,e){return e=e||this.parallax,this.xOffset+=-t*e,this.yOffset+=-i*e,this},this.positionOverCanvas=function(){var t=jQuery("<div></div>"),i=$canvas.offset();t.css({left:i.left,pointerEvents:"none",position:"absolute",top:i.top});var e=jQuery(this.canvas);return e.css({backgroundColor:"transparent",margin:"0 auto",overflow:"hidden",pointerEvents:"none",position:"absolute","z-index":50}),t.append(e),jQuery("body").append(t),t},this.showCanvasOverlay=function(){stopAnimating();var i=jQuery("<div></div>");i.css({cursor:"pointer",display:"block",height:"100%",left:0,position:"absolute",top:0,width:"100%"});var t=jQuery(this.canvas);return t.css({border:"1px solid black",display:"block",margin:"0 auto",position:"absolute","z-index":100}).click(function(){i.remove(),startAnimating()}),i.append(t),jQuery("body").append(i),i.click(function(t){3!=t.which&&i.remove()}),i}}"undefined"!=typeof Sprite&&(Sprite.getImageFromCache=function(t){return Caches.images[t]},Sprite.saveImageToCache=function(t,i){Caches.images[t]=i},Sprite.preloadImages=Caches.preloadImages),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},function(){var n=!1,t=!1;function i(){void 0!==App.stats&&App.stats.begin();var t=App.timer.getDelta();for(App.timer.running||App.timer.start(),App.MIN_FPS&&t>1/App.MIN_FPS&&(jQuery(document).trigger("low_fps",[1/t]),t=1/App.MIN_FPS),App.timer.frames++,App.debugMode&&Timer.event("debug timer update",!0),window.Mouse&&Mouse.Scroll&&Mouse.Scroll._update();0<t&&!App.isGameOver;)App.physicsDelta=Math.min(t,1/App.MAX_FPS),"function"==typeof update&&update(App.physicsDelta,App.physicsTimeElapsed),t-=App.physicsDelta,App.physicsTimeElapsed+=App.physicsDelta;App.debugMode&&(App.Debug.updateTimeElapsed+=Timer.getTimeSince("debug timer update"),Timer.event("debug timer clear",!0)),context.clear(),App.debugMode&&(App.Debug.clearTimeElapsed+=Timer.getTimeSince("debug timer clear"),Timer.event("debug timer draw",!0)),draw(),App.debugMode&&(App.Debug.drawTimeElapsed+=Timer.getTimeSince("debug timer draw")),void 0!==App.stats&&App.stats.end(),n&&window.requestAnimFrame(i)}window.startAnimating=function(){n||void 0===App.timer||(n=!0,jQuery(document).trigger("startAnimating"),i())},window.stopAnimating=function(){if(n&&void 0!==App.timer&&(n=!1,App.timer.stop(),jQuery(document).trigger("stopAnimating"),App.debugMode&&console&&console.log)){var t=App.physicsTimeElapsed,i=App.timer.frames,e=App.Debug,s=e.updateTimeElapsed+e.clearTimeElapsed+e.drawTimeElapsed;console.log({"ms/frame":{update:e.updateTimeElapsed/i,clear:e.clearTimeElapsed/i,draw:e.drawTimeElapsed/i,animOps:s/i,other:(t-s)/i,animate:t/i},percent:{update:e.updateTimeElapsed/t*100,clear:e.clearTimeElapsed/t*100,draw:e.drawTimeElapsed/t*100,animOps:s/t*100,other:(t-s)/t*100},fps:i/t})}},window.isAnimating=function(){return n},jQuery(window).on("focus.animFocus",function(){t&&!App.isGameOver&&(t=!1,startAnimating())}),jQuery(window).on("blur.animFocus",function(){stopAnimating(),t=!0})}(),App.preventDefaultKeyEvents=function(t){jQuery.hotkeys?jQuery(document).keydown(t,function(){return!1}):window.console&&console.warn&&console.warn("Tried to prevent default key events but jQuery.hotkeys does not exist.")},window.performance=window.performance||{},performance.now=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return Date.now()},function(){var s={},n=0;Timer.event=function(t,i){var e={whileAnimating:i,startTime:i?App.physicsTimeElapsed:performance.now()};void 0===t?n=e:s[t]=e},Timer.getTimeSince=function(t){var i=void 0===s[t]?n:s[t],e=i.whileAnimating?App.physicsTimeElapsed:performance.now();return i.startTime?(e-i.startTime)/1e3:0}}(),App.Utils={},App.Utils.getRandBetween=function(t,i){if(i<t){var e=t;t=i,i=e}return Math.random()*(i-t)+t},App.Utils.getRandIntBetween=function(t,i){if(i<t){var e=t;t=i,i=e}return t=Math.ceil(t),i=Math.floor(i),Math.floor(Math.random()*(i-t+1)+t)},App.Utils.anyIn=function(t,i){for(var e=0,s=t.length;e<s;e++)if(-1!=i.indexOf(t[e]))return!0;return!1},App.Utils.almostEqual=function(t,i,e){return i-e<=t&&t<=i+e},App.Utils.randomString=function(t){var i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_",e="";t=t||32;for(var s=0;s<t;s++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},App.Utils.positionOverCanvas=function(t,i,e){var s=$canvas.offset();return jQuery(t).detach().appendTo("body").css({left:s.left+parseInt($canvas.css("border-left-width"),10)+i+"px",position:"absolute",top:s.top+parseInt($canvas.css("border-top-width"),10)+e+"px","z-index":100})},App.gameOver=function(e){App.isGameOver||(App.isGameOver=!0,stopAnimating(),player&&player.destroy(),"string"!=typeof e&&(e="GAME OVER"),setTimeout(function(){context.save(),context.font="100px Arial",context.fillStyle="black",context.strokeStyle="lightGray",context.textBaseline="middle",context.textAlign="center",context.shadowColor="black",context.shadowBlur=8,context.lineWidth=5;var t=Math.round(world.xOffset+canvas.width/2),i=Math.round(world.yOffset+canvas.height/2);context.strokeText(e,t,i),context.fillText(e,t,i),context.restore()},100),$canvas.css("cursor","pointer"),$canvas.one("click.gameover",function(t){t.preventDefault(),$canvas.css("cursor","auto"),App.reset()}))},Array.prototype.remove=function(t){var i=this.indexOf(t);if(!(void 0===i||i<0))return this.splice(i,1)},Number.prototype.round=function(t,i){void 0===i&&(i=t,t=this),i=i||0;var e=Math.pow(10,0|i);return Math.round(t*e)/e},Number.prototype.sign=function(t){return void 0===t&&(t=this),0<t?1:t<0?-1:0},CanvasRenderingContext2D.prototype.clear=function(t){this.save();var i=0,e=0;this.__layer?(i=this.__layer.xOffset,e=this.__layer.yOffset):this.setTransform(1,0,0,1,0,0),t?(this.fillStyle=t,this.fillRect(i,e,this.canvas.width,this.canvas.height)):this.clearRect(i,e,this.canvas.width,this.canvas.height),this.restore()},CanvasRenderingContext2D.prototype.__drawImage=CanvasRenderingContext2D.prototype.drawImage,CanvasRenderingContext2D.prototype.drawImage=function(t,i,e,s,n,a,o,r,h,l){arguments.length%2==0&&(l=Array.prototype.pop.call(arguments),s instanceof Function?s=void 0:a instanceof Function?a=void 0:r instanceof Function&&(r=void 0),"function"!=typeof l&&(l=void 0));var c=this,d=arguments;"number"!=typeof a&&void 0===o&&"number"!=typeof r&&void 0===h&&(a=i,o=e,"number"==typeof s&&void 0!==n&&(r=s,h=n),n=s=e=i=void 0);var p=function(t,i,e,s,n,a,o,r,h){s&&n?r&&h?c.__drawImage(t,a,o,r,h,i,e,s,n):c.__drawImage(t,i,e,s,n):c.__drawImage(t,i,e),l instanceof Function&&l.call(c,d,!0)},u;if("undefined"!=typeof Sprite&&t instanceof Sprite||"undefined"!=typeof SpriteMap&&t instanceof SpriteMap)t.draw(this,a,o,r,h),l instanceof Function&&l.call(c,d,!0);else if(void 0!==Layer&&t instanceof Layer){c.save(),c.globalAlpha=t.opacity,"canvas"==t.relative&&c.translate(world.xOffset,world.yOffset);var f=l;l=void 0,p(t.canvas,a,o,r,h,i,e,s,n),c.restore(),(l=f)instanceof Function&&l.call(c,d,!0)}else if(t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)p(t,a,o,r,h,i,e,s,n);else if(t instanceof HTMLImageElement||t instanceof Image){if(!(t=(u=t)._src||u.src))return l instanceof Function&&l.call(c,d,!1),void 0;if(Caches.images[t]||(Caches.images[t]=u),u.complete||u.width&&u.height)p(u,a,o,r,h,i,e,s,n);else{if(u._src)return;var g=u.onload;u.onload=function(){"function"==typeof g&&g(),l instanceof Function&&l.call(c,d,!1)}}}else if("string"==typeof t&&Caches.images[t])((u=Caches.images[t]).complete||u.width&&u.height)&&p(u,a,o,r,h,i,e,s,n);else{if("string"!=typeof t)throw new TypeMismatchError("Image type not recognized.");(u=new Image).onload=function(){l instanceof Function&&l.call(c,d,!1)},u._src=t,u.src=t,Caches.images[t]=u}},CanvasRenderingContext2D.prototype.drawPattern=function(t,i,e,s,n,a,o){var r;if(void 0===i&&(i=0),void 0===e&&(e=0),void 0===s&&(s=this.canvas.width),void 0===n&&(n=this.canvas.height),a="function"==typeof a?(o=a,"repeat"):a||"repeat",void 0!==Layer&&t instanceof Layer&&(t=t.canvas),t instanceof CanvasPattern)this.fillStyle=t,this.fillRect(i,e,s,n),o instanceof Function&&o.call(this,arguments,!0);else if(void 0!==Layer&&t instanceof Layer)this.save(),this.globalAlpha=t.opacity,"canvas"==t.relative&&this.translate(world.xOffset,world.yOffset),this.fillStyle=this.createPattern(t.canvas,a),this.fillRect(i,e,s,n),this.restore(),o instanceof Function&&o.call(this,arguments,!0);else if(t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)this.fillStyle=this.createPattern(t,a),this.fillRect(i,e,s,n),o instanceof Function&&o.call(this,arguments,!0);else if(t instanceof HTMLImageElement||t instanceof Image){if(!(t=(r=t)._src||r.src))return o instanceof Function&&o.call(this,arguments,!1),void 0;if(Caches.imagePatterns[t])return this.fillStyle=Caches.imagePatterns[t],this.fillRect(i,e,s,n),o instanceof Function&&o.call(this,arguments,!0),this.fillStyle;if(Caches.images[t]||(Caches.images[t]=r),r.complete||r.width&&r.height)this.fillStyle=this.createPattern(r,a),this.fillRect(i,e,s,n),Caches.imagePatterns[t]=this.fillStyle,o instanceof Function&&o.call(this,arguments,!0);else{if(r._src)return;var h=this,l=r.onload;r.onload=function(){"function"==typeof l&&l(),Caches.imagePatterns[t]=this.createPattern(r,a),o instanceof Function&&o.call(h,arguments,!1)}}}else if("string"==typeof t)if(Caches.imagePatterns[t])this.fillStyle=Caches.imagePatterns[t],this.fillRect(i,e,s,n),o instanceof Function&&o.call(this,arguments,!0);else if(Caches.images[t])((r=Caches.images[t]).complete||r.width&&r.height)&&(this.fillStyle=this.createPattern(r,a),this.fillRect(i,e,s,n),Caches.imagePatterns[t]=this.fillStyle,o instanceof Function&&o.call(this,arguments,!0));else{var c=this;(r=new Image).onload=function(){Caches.imagePatterns[t]=this.createPattern(r,a),o instanceof Function&&o.call(c,arguments,!1)},r._src=t,r.src=t,Caches.images[t]=r}if(Caches.imagePatterns[t])return Caches.imagePatterns[t]},CanvasRenderingContext2D.prototype.drawCheckered=function(t,i,e,s,n,a,o){if(void 0===t&&(t=80),"string"==typeof t&&"string"==typeof i){var r=t,h=i;t=e,i=s,e=n,s=a,n=o,a=r,o=h}var l=document.createElement("canvas"),c=l.getContext("2d");return l.width=2*t,l.height=2*t,c.fillStyle=a||"silver",c.fillRect(0,0,t,t),c.fillRect(t,t,t,t),c.fillStyle=o||"lightGray",c.fillRect(t,0,t,t),c.fillRect(0,t,t,t),this.drawPattern(l,i||0,e||0,s||this.canvas.width,n||this.canvas.height)},CanvasRenderingContext2D.prototype.circle=function(t,i,e,s,n){this.beginPath(),this.arc(t,i,e,0,2*Math.PI,!1),null!==s&&(s&&(this.fillStyle=s),this.fill()),void 0!==n&&(this.lineWidth=Math.max(Math.ceil(e/15),1),n&&(this.strokeStyle=n),this.stroke())},App.isSomethingBeingDragged=!1;var Mouse={Coords:{x:-9999,y:-9999,physicalX:-9999,physicalY:-9999,worldX:function(){return 0<=this.x?this.x+world.xOffset:-9999},worldY:function(){return 0<=this.y?this.y+world.yOffset:-9999}}};function Collection(){this.concat.apply(this,arguments)}function ImageWrapper(t,i,e,s,n){this.src=t,this.x=i,this.y=e,this.width=s,this.height=n,this.draw=function(t){(t||context).drawImage(this.src,this.x,this.y,this.width,this.height)}}function TileMap(n,t,i){var e,s,a,o;this.options={cellSize:[Box.prototype.DEFAULT_WIDTH,Box.prototype.DEFAULT_HEIGHT],gridSize:null,startCoords:i?i.startCoords:void 0},i&&i.cellSize instanceof Array&&1<i.cellSize.length&&(this.options.cellSize=i.cellSize),i&&i.gridSize instanceof Array&&1<i.gridSize.length&&(this.options.gridSize=i.gridSize),null==t&&(t=[]),void 0!==this.options.startCoords&&0!==this.options.startCoords.length||(this.options.startCoords=[0,world.height-this.options.cellSize[1]*("string"==typeof n?n.split("\n"):n).length]);var r=this.options.gridSize,h=this.options.cellSize[0],l=this.options.cellSize[1],c=this.options.startCoords[0],d=this.options.startCoords[1];if(r instanceof Array&&0<r.length){for(n=new Array(r[0]),e=0;e<r[0];e++)for(n[e]=new Array(r[1]),s=0;s<r[1];s++)n[e][s]=null;this.grid=n}else if("string"==typeof n){for(e=0,a=(n=n.split("\n")).length;e<a;e++)n[e]=n[e].split("");this.grid=n}else for(a=n.length,this.grid=new Array(a),e=0;e<a;e++)for(o=n[e].length,this.grid[e]=new Array(o),s=0;s<o;s++)this.grid[e][s]=n[e][s];for(void 0!==t&&void 0===t[" "]&&(t[" "]=null),e=0,a=n.length;e<a;e++)for(s=0,o=n[e].length;s<o;s++)if(null!==n[e][s]){var p=t?t[n[e][s]]:n[e][s];if(null==p)this.grid[e][s]=null;else{var u=c+s*h,f=d+e*l;"string"==typeof p||p instanceof Image||p instanceof HTMLImageElement||p instanceof HTMLCanvasElement||p instanceof Sprite||p instanceof SpriteMap||p instanceof Layer?this.grid[e][s]=new ImageWrapper(p,u,f,h,l):p instanceof Function?this.grid[e][s]=new(Function.prototype.bind.call(p,null,u,f,h,l)):this.grid[e][s]=null}}else this.grid[e][s]=null;this.draw=function(t,i,e){var s,n;if(t=t||context,!i){for(s=0,n=this.grid.length;s<n;s++)for(var a=0,o=this.grid[s].length;a<o;a++){var r=this.grid[s][a];null!==r&&r.draw(t,e)}return this}var h=this.getCellsInRect();for(s=0,n=h.length;s<n;s++)h[s].draw(t,e)},this.getCell=function(t,i){return this.grid[t]?this.grid[t][i]:void 0},this.setCell=function(t,i,e){return this.grid[t]&&void 0!==this.grid[t][i]&&(this.grid[t][i]=e),this},this.clearCell=function(t,i){return this.grid[t]&&(this.grid[t][i]=null),this},this.getAll=function(){var t=this.grid.length,i=0<t?this.grid[0].length:0,e=[],s,n;for(s=0;s<t;s++)for(n=0;n<i;n++)null!==this.grid[s][n]&&e.push(this.grid[s][n]);return e},this.clearAll=function(){var t=this.grid.length,i=0<t?this.grid[0].length:0,e,s;for(this.grid=new Array(t),e=0;e<t;e++)for(this.grid[e]=new Array(i),s=0;s<i;s++)n[e][s]=null;return this},this.getRows=function(){return this.grid.length},this.getCols=function(){return 0<this.grid.length?this.grid[0].length:0},this.forEach=function(t,i){var e=this.grid.length,s=0<e?this.grid[0].length:0,n,a;for(n=0;n<e;n++)for(a=0;a<s;a++)(null!==this.grid[n][a]||i)&&t(this.grid[n][a],n,a)&&("function"==typeof this.grid[n][a].destroy&&this.grid[n][a].destroy(),this.clearCell(n,a));return this},this._getCellCoordsInRect=function(t,i,e,s){void 0===t&&(t=world.xOffset),void 0===i&&(i=world.yOffset),void 0===e&&(e=canvas.width),void 0===s&&(s=canvas.height);var n=this.options.startCoords[0],a=this.options.startCoords[1],o=this.options.cellSize[0],r=this.options.cellSize[1],h=(t-n)/o,l=(i-a)/r,c=(t+e-n)/o,d=(a-i+s)/r;return[Math.floor(h),Math.floor(l),Math.ceil(c),Math.ceil(d)]},this.getCellsInRect=function(t,i,e,s){for(var n=this._getCellCoordsInRect(t,i,e,s),a=[],o=Math.min(this.getRows(),Math.max(0,n[1])),r=Math.min(this.getRows(),Math.max(0,n[3])),h=Math.min(this.getCols(),Math.max(0,n[0])),l=Math.min(this.getCols(),Math.max(0,n[2])),c=o,d=r;c<d;c++)for(var p=h,u=l;p<u;p++)null!==this.grid[c][p]&&a.push(this.grid[c][p]);return a},this.getCellCoords=function(t,i){return{row:Math.round((i-this.options.startCoords[1])/this.options.cellSize[1]),col:Math.round((t-this.options.startCoords[0])/this.options.cellSize[0])}},this.getPixelCoords=function(t,i){return{x:this.options.startCoords[0]+this.options.cellSize[0]*t,y:this.options.startCoords[1]+this.options.cellSize[1]*i}}}jQuery(document).ready(function(){var i=function(t){try{var i=t.pageX||t.originalEvent.touches[0].pageX,e=t.pageY||t.originalEvent.touches[0].pageY;"touchmove"==t.type&&t.preventDefault(),Mouse.Coords.physicalX=i-$canvas.offset().left,Mouse.Coords.physicalY=e-$canvas.offset().top,Mouse.Coords.x=Math.round(Mouse.Coords.physicalX*world._actualXscale),Mouse.Coords.y=Math.round(Mouse.Coords.physicalY*world._actualYscale)}catch(t){}};$canvas.on("touchmove.coords",i),$canvas.hover(function(){jQuery(this).on("mousemove.coords",i)},function(){jQuery(this).off("mousemove.coords"),Mouse.Coords.physicalX=-9999,Mouse.Coords.physicalY=-9999,Mouse.Coords.x=-9999,Mouse.Coords.y=-9999}),$canvas.on("mousedown mouseup click touchstart touchend",function(t){"touchstart"==t.type&&i(t),isAnimating()&&void 0!==App.Events&&App.Events.trigger(t.type,t)}),$canvas.on("mouseup.drag touchend.drag",function(t){void 0!==App.Events&&App.Events.trigger("canvasdragstop",t),App.isSomethingBeingDragged=!1,jQuery(document).trigger("canvasdragstop")}),jQuery(document).on("canvasdrop",function(t,i){void 0!==App.Events&&App.Events.trigger("canvasdrop",t,i)})}),App.isHovered=function(t){return Mouse.Coords.worldX()>t.x&&Mouse.Coords.worldX()<t.x+t.width&&Mouse.Coords.worldY()>t.y&&Mouse.Coords.worldY()<t.y+t.height},Mouse.Scroll=function(){var s=.2,n=350,t=!1,i=!1,e=!1,a=!1,o={x:0,y:0},r={THRESHOLD:function(){return 1},LINEAR:function(t){return 1-t},SMOOTH:function(t){return.5-Math.cos((1-t)*Math.PI)/2},EXPONENTIAL:function(t){return Math.sqrt(1-t)}},h=r.SMOOTH;function l(){var t,i,e=a;return Mouse.Coords.x<canvas.width*s?(i=h(Mouse.Coords.x/(canvas.width*s)),t=Math.round(i*Math.min(world.xOffset,n*App.physicsDelta)),world.xOffset-=t,o.x-=t,context.translate(t,0)):Mouse.Coords.x>canvas.width*(1-s)&&(i=h((canvas.width-Mouse.Coords.x)/(canvas.width*s)),t=Math.round(i*Math.min(world.width-canvas.width-world.xOffset,n*App.physicsDelta)),world.xOffset+=t,o.x+=t,context.translate(-t,0)),Mouse.Coords.y<canvas.height*s?(i=h(Mouse.Coords.y/(canvas.height*s)),t=Math.round(i*Math.min(world.yOffset,n*App.physicsDelta)),world.yOffset-=t,o.y-=t,context.translate(0,t)):Mouse.Coords.y>canvas.height*(1-s)&&(i=h((canvas.height-Mouse.Coords.y)/(canvas.height*s)),t=Math.round(i*Math.min(world.height-canvas.height-world.yOffset,n*App.physicsDelta)),world.yOffset+=t,o.y+=t,context.translate(0,-t)),a=0!==o.x&&0!==o.y,!e&&a?jQuery(document).trigger("mousescrollon"):e&&!a&&jQuery(document).trigger("mousescrolloff"),o}return{enable:function(){t||(t=!0,$canvas.one("mousemove.translate",function(){0<=Mouse.Coords.x&&0<=Mouse.Coords.y&&(i=!0,l())}),$canvas.on("mouseenter.translate touchstart.translate",function(){i=!0,l()}),$canvas.on("mouseleave.translate touchleave.translate",function(){i=!1,a&&(a=!1,jQuery(document).trigger("mousescrolloff"))}),$canvas.on("mousedown.translate touchstart.translate",function(){e=!0}),$canvas.on("mouseup.translate touchend.translate",function(){e=!1}))},disable:function(){$canvas.off(".translate"),a=t=i=!1},isEnabled:function(){return t},isScrolling:function(){return a},_update:function(){if(i&&!e)return l()},easings:r,setEasingFunction:function(t){h=t},getEasingFunction:function(){return h},setThreshold:function(t){s=t},getThreshold:function(){return s},setScrollDistance:function(t){n=t},getScrollDistance:function(){return n}}}(),function(){function t(){return"function"!=typeof App.isHovered?(window.console&&console.warn&&console.warn("Mouse event triggered, but App.isHovered does not exist."),!1):App.isHovered(this)}var c={};App.Events={listen:function(t,i,e,s){var n=arguments[4],a=i.split(" ");if(!(1<a.length)){var o="",r=i.indexOf(".");return-1!==r&&(o=i.substring(r+1),i=i.substring(0,r)),c[i]||(c[i]=[]),c[i].push({object:t,callback:function(){e.apply(t,arguments)},namespace:o,weight:s||0,once:n||!1}),t}for(var h=0,l=a.length;h<l;h++)App.Events.listen(t,a[h],e,s,n)},once:function(t,i,e,s){return App.Events.listen(t,i,e,s,!0)},unlisten:function(t,i){var e=i.split(" ");if(!(1<e.length)){var s="",n=i.indexOf("."),a;if(-1!==n&&(s=i.substring(n+1),i=i.substring(0,n)),i&&c[i])for(n=(a=c[i]).length-1;0<=n;n--)a[n].object!=t||s&&a[n].namespace!=s||c[i].splice(n,1);else if(!i&&s)for(i in c)if(c.hasOwnProperty(i))for(n=(a=c[i]).length-1;0<=n;n--)a[n].object==t&&a[n].namespace==s&&c[i].splice(n,1);return t}for(var o=0,r=e.length;o<r;o++)App.Events.unlisten(t,e[o])},trigger:function(){var t=Array.prototype.shift.call(arguments),i=arguments[0],e=c[t];if(e){e.sort(function(t,i){return i.weight-t.weight});for(var s=e.length-1;0<=s&&(App.Events.Behaviors[t]&&!App.Events.Behaviors[t].apply(e[s].object,arguments)||(e[s].callback.apply(e[s].object,arguments),e[s].once&&App.Events.unlisten(e[s].object,t+"."+e[s].namespace),!(i&&i.isPropagationStopped&&i.isPropagationStopped())));s--);}},Behaviors:{mousedown:t,mouseup:t,click:t,touchstart:t,touchend:t,canvasdragstop:function(){return!!this.isBeingDragged},canvasdrop:function(t,i){return this===i}}}}.call(this),App.Storage=function(t,e){var s={enabled:!0},n="__appstore__",a=t.localStorage,o={},i=!1;s.set=function(t,i){if(t=n+t,i===e)return s.remove(t);a.setItem(t,JSON.stringify(i))},s.get=function(t,i){t=n+t;try{var e=a.getItem(t);if("string"==typeof e)return JSON.parse(e);if(null!==e)return e}catch(t){console&&console.error&&console.error(t)}return i},s.remove=function(t){a.removeItem(n+t)},s.clear=function(){a.clear()},s.length=function(){return 0,a.length},s.key=function(t){return a.key(t)},s.isEnabled=function(){return s.enabled};try{s.set(n,n),s.get(n)!=n&&(s.enabled=!1),s.remove(n)}catch(t){s.enabled=!1}return s.enabled||(a={setItem:function(t,i){o[t]=i},getItem:function(t){return o[t]},removeItem:function(t){delete o[t]},clear:function(){o={}},key:function(t){var i=0;for(var e in o)if(o.hasOwnProperty(e)){if(i==t)return o[e];i++}}}),s}(window),Collection.prototype={length:0,draw:function(t){t=t||context;for(var i=0;i<this.length;i++)this[i].draw(t);return this},forEach:function(t){if("string"==typeof t)return this._executeMethod.apply(this,arguments);for(var i=this.length-1;0<=i;i--)t(this[i])&&("function"==typeof this[i].destroy&&this[i].destroy(),this.splice(i,1));return this},_executeMethod:function(){for(var t=Array.prototype.shift.call(arguments),i=0;i<this.length;i++)this[i][t].apply(this[i],arguments);return this},collideAll:function(t){for(var i=!1,e=0,s=this.length;e<s;e++)for(var n=e+1;n<s;n++)if(this[e].overlaps(this[n])){if("function"!=typeof t)return!0;t.call(this,this[e],this[n]),i=!0}return i},getAll:function(){Array.prototype.slice.call(this)},splice:Array.prototype.splice,add:Array.prototype.push,concat:function(){for(var t=0,i=arguments.length;t<i;t++)if(arguments[t]instanceof Array||arguments[t]instanceof Collection)for(var e=0,s=arguments[t].length;e<s;e++)Array.prototype.push.call(this,arguments[t][e]);else Array.prototype.push.call(this,arguments[t]);return this},remove:Array.prototype.remove,removeLast:Array.prototype.pop,removeFirst:Array.prototype.shift,removeAll:function(){return Array.prototype.splice.call(this,0,this.length),this},indexOf:Array.prototype.indexOf};var Box=Class.extend({init:function(t,i,e,s,n){this.x=void 0!==t?t:Math.floor((world.width-this.DEFAULT_WIDTH)/2),this.y=void 0!==i?i:Math.floor((world.height-this.DEFAULT_HEIGHT)/2),this.width=e||this.DEFAULT_WIDTH,this.height=s||this.DEFAULT_HEIGHT,this.fillStyle=n||"black"},DEFAULT_WIDTH:80,DEFAULT_HEIGHT:80,src:null,radians:0,draw:function(t,i){void 0===i&&(i=!0),(t=t||context).save(),t.fillStyle=this.fillStyle;var e=this.x,s=this.y,n=this.width,a=this.height;i&&(e=Math.round(e),s=Math.round(s)),this.radians&&(t.translate(e+n/2,s+a/2),t.rotate(this.radians),t.translate(-n/2-e,-a/2-s)),this.src?t.drawImage(this.src,e,s,n,a):this.drawDefault(t,e,s,n,a),t.restore()},drawDefault:function(t,i,e,s,n){t.fillRect(i,e,s,n)},drawBoundingBox:function(t,i){t=t||context,i&&(t.strokeStyle=i),t.strokeRect(this.x,this.y,this.width,this.height)},xC:function(){return this.x+this.width/2},yC:function(){return this.y+this.height/2},collides:function(t,i,e){if(t instanceof Box&&(t!==this||!e))return!!this.overlaps(t)&&t;var s=t,n=[];void 0!==TileMap&&t instanceof TileMap&&(s=t.getAll());for(var a=0,o=s.length;a<o;a++)if(this.overlaps(s[a])&&(s[a]!==this||!e)){if(!i)return s[a];n.push(s[a])}return!!n.length&&n},overlaps:function(t){return this.overlapsX(t)&&this.overlapsY(t)},overlapsX:function(t){return this.x+this.width>t.x&&t.x+t.width>this.x},overlapsY:function(t){return this.y+this.height>t.y&&t.y+t.height>this.y},isHovered:function(){return"function"!=typeof App.isHovered?(window.console&&console.warn&&console.warn("Box#isHovered called, but App.isHovered does not exist."),!1):App.isHovered(this)},listen:function(t,i,e){return App.Events?App.Events.listen(this,t,i,e):window.console&&console.warn&&console.warn("Box#listen called, but App.Events does not exist."),this},once:function(t,i,e){return App.Events?App.Events.once(this,t,i,e):window.console&&console.warn&&console.warn("Box#once called, but App.Events does not exist."),this},unlisten:function(t){return App.Events?App.Events.unlisten(this,t):window.console&&console.warn&&console.warn("Box#unlisten called, but App.Events does not exist."),this},destroy:function(){},stoodOn:null}),Actor=Box.extend({MOVEAMOUNT:400,GRAVITY:!1,G_CONST:21,JUMP_VEL:500,JUMP_DELAY:.25,AIR_CONTROL:.25,JUMP_RELEASE:!1,MULTI_JUMP:0,CONTINUOUS_MOVEMENT:!1,STAY_IN_WORLD:!0,DAMPING_FACTOR:null,lastLooked:[],isBeingDragged:!1,dropTargets:[],xVelocity:0,yVelocity:0,xAcceleration:0,yAcceleration:0,keys:void 0,lastJump:0,lastDirection:[],jumpDirection:{right:!1,left:!1},jumpKeyDown:!1,numJumps:0,inAir:!1,fallLeft:null,isDraggable:!1,dragStartX:0,dragStartY:0,animLoop:"",init:function(){this._super.apply(this,arguments),this.lastX=this.x,this.lastY=this.y,this.lastDirection=[],this.lastLooked=[],this.jumpDirection={right:!1,left:!1},this.dropTargets=[],arguments.length<5&&(this.fillStyle="lightBlue")},draw:function(){return this.src instanceof SpriteMap&&this.animLoop&&this.src.use(this.animLoop),this._super.apply(this,arguments)},drawDefault:function(t,i,e,s,n){i+=s/2,e+=n/2;var a=(s+n)/4;t.circle(i,e,a,this.fillStyle,"black"),t.beginPath(),t.arc(i,e,.6*a,.1*Math.PI,.9*Math.PI,!1),t.lineWidth=Math.max(Math.ceil(a/15),1),t.strokeStyle="black",t.stroke(),t.beginPath(),t.arc(i-.3*a,e-.25*a,Math.max(Math.ceil(a/15),1),0,2*Math.PI,!1),t.fillStyle="black",t.fill(),t.arc(i+.3*a,e-.25*a,Math.max(Math.ceil(a/15),1),0,2*Math.PI,!1),t.fill()},update:function(t){this.lastX=this.x,this.lastY=this.y,this.isBeingDragged&&window.Mouse?(this.x=Mouse.Coords.worldX()-this.width/2,this.y=Mouse.Coords.worldY()-this.height/2):(this.processInput(t),this.ambientAcceleration(),this.move(),App.Utils.almostEqual(this.lastX,this.x,1e-6)&&(this.fallLeft=null),!this.GRAVITY||this.y+this.height==world.height&&this.STAY_IN_WORLD||this.startFalling()),this.updateAnimation(),this.dampVelocity()},processInput:function(t){var i=!1,e=!1,s=!1,n=App.Utils.anyIn,a=this.keys||window.keys;if(void 0!==a){if(void 0===t||0===t.length){if(!this.CONTINUOUS_MOVEMENT)return;t=this.lastLooked}if(this.lastDirection=t.slice(),n(a.left,t)?(s=i=!0,this.fallLeft=!0,this.GRAVITY&&this.isInAir()?!this.jumpDirection.right&&this.jumpDirection.left||(this.xVelocity=-this.MOVEAMOUNT*this.AIR_CONTROL,this.jumpDirection.right=!1,this.jumpDirection.left=!1):this.xVelocity=-this.MOVEAMOUNT):n(a.right,t)&&(s=e=!0,this.fallLeft=!1,this.GRAVITY&&this.isInAir()?!this.jumpDirection.left&&this.jumpDirection.right||(this.xVelocity=this.MOVEAMOUNT*this.AIR_CONTROL,this.jumpDirection.right=!1,this.jumpDirection.left=!1):this.xVelocity=this.MOVEAMOUNT),n(a.up,t)){if(this.GRAVITY){if(!this.isInAir()||this.MULTI_JUMP>this.numJumps||-1==this.MULTI_JUMP){var o=App.physicsTimeElapsed;!(o-this.lastJump>this.JUMP_DELAY)||this.JUMP_RELEASE&&this.jumpKeyDown||(this.yVelocity=-this.JUMP_VEL,this.yAcceleration=0,this.lastJump=o,this.jumpDirection.right=e,this.jumpDirection.left=i,this.numJumps++,this.inAir=!0)}}else this.yVelocity=-this.MOVEAMOUNT,s=!0;this.jumpKeyDown=!0}else n(a.down,t)&&(this.isInAir()&&this.GRAVITY||(this.yVelocity=this.MOVEAMOUNT,s=!0));if(s&&(this.lastLooked=t.slice(),this.GRAVITY))for(var r=this.lastLooked.length-1;0<=r;r--)-1==a.left.indexOf(this.lastLooked[r])&&-1==a.right.indexOf(this.lastLooked[r])&&this.lastLooked.splice(r,1)}},ambientAcceleration:function(){this.GRAVITY&&(this.isInAir()?(this.yAcceleration+=this.G_CONST,this.jumpDirection.left?this.xVelocity=-this.MOVEAMOUNT:this.jumpDirection.right&&(this.xVelocity=this.MOVEAMOUNT)):this.stopFalling())},move:function(){var t=App.physicsDelta,i=t/2;this.xVelocity+=this.xAcceleration*i,this.yVelocity+=this.yAcceleration*i;var e=this.xVelocity,s=this.yVelocity;if(0!==e&&0!==s&&!this.GRAVITY){var n,a,o=Math.max(Math.abs(e),Math.abs(s))/Math.sqrt(e*e+s*s);this.xVelocity*=o,this.yVelocity*=o}this.x+=this.xVelocity*t,this.y+=this.yVelocity*t,this.xVelocity+=this.xAcceleration*i,this.yVelocity+=this.yAcceleration*i,this.stayInWorld()},stayInWorld:function(){this.STAY_IN_WORLD&&(this.x<0?this.x=0:this.x+this.width>world.width&&(this.x=world.width-this.width),this.y<0?this.y=0:this.y+this.height>world.height&&(this.y=world.height-this.height,this.stopFalling()))},dampVelocity:function(){if(null!==this.DAMPING_FACTOR&&!App.Utils.almostEqual(this.xVelocity,0,1e-4))return this.xVelocity*=1-this.DAMPING_FACTOR*App.physicsDelta,this.GRAVITY||App.Utils.almostEqual(this.yVelocity,0,1e-4)||(this.yVelocity*=1-this.DAMPING_FACTOR*App.physicsDelta),void 0;this.xVelocity=0,this.GRAVITY||(this.yVelocity=0)},addVelocityVector:function(t,i){this.xVelocity+=i*Math.cos(t),this.yVelocity+=i*Math.sin(t)},setVelocityVector:function(t,i){this.xVelocity=i*Math.cos(t),this.yVelocity=i*Math.sin(t)},getVelocityVector:function(){return{magnitude:Math.sqrt(this.xVelocity*this.xVelocity+this.yVelocity*this.yVelocity),direction:Math.atan2(this.yVelocity,this.xVelocity)}},addAccelerationVector:function(t,i){this.xAcceleration+=i*Math.cos(t),this.yAcceleration+=i*Math.sin(t)},setAccelerationVector:function(t,i){this.xAcceleration=i*Math.cos(t),this.yAcceleration=i*Math.sin(t)},getAccelerationVector:function(){return{magnitude:Math.sqrt(this.xVelocity*this.xVelocity+this.yVelocity*this.yVelocity),direction:Math.atan2(this.yVelocity,this.xVelocity)}},moveOutside:function(t){var i,e;return Math.min(this.x+this.width-t.x,t.x+t.width-this.x)<=Math.min(this.y+this.height-t.y,t.y+t.height-this.y)?{x:this.moveOutsideX(t),y:this.moveOutsideY(t)}:{y:this.moveOutsideY(t),x:this.moveOutsideX(t)}},moveOutsideX:function(t){var i=0,e;return this.overlaps(t)&&(i=(e=this.x+this.width/2<t.x+t.width/2?t.x-this.width-.01:t.x+t.width+.01)-this.x,this.x=e),i},moveOutsideY:function(t){var i=0,e;return this.overlaps(t)&&(i=(e=this.y+this.height/2<=t.y+t.height/2?t.y-this.height-1:t.y+t.height+1)-this.y,this.y=e),i},startFalling:function(){this.inAir||null===this.fallLeft||(this.jumpDirection.left=this.fallLeft,this.jumpDirection.right=!this.fallLeft),this.inAir=!0},stopFalling:function(){0<this.yAcceleration&&(this.yAcceleration=0),0<this.yVelocity&&(this.yVelocity=0),this.numJumps=0,this.inAir=!1},isInAir:function(){return this.inAir},isJumping:function(){return 0<this.numJumps},isFalling:function(){return this.isInAir()&&0===this.numJumps},hasAirMomentum:function(){return null!==this.fallLeft||this.jumpDirection.left||this.jumpDirection.right},standingOn:function(t){if(void 0!==Collection&&t instanceof Collection||void 0!==TileMap&&t instanceof TileMap){for(var i=t.getAll(),e=0,s=i.length;e<s;e++)if(this.standingOn(i[e]))return!0;return!1}return this.overlapsX(t)&&App.Utils.almostEqual(this.y+this.height,t.y,1)},collideSolid:function(t){var i={x:0,y:0};if(t instanceof Box||t instanceof ImageWrapper)i=this._collideSolidBox(t);else if(void 0!==Collection&&t instanceof Collection||void 0!==TileMap&&t instanceof TileMap)for(var e=t.getAll(),s=0,n=e.length;s<n;s++){var a=this._collideSolidBox(e[s]);a.x&&(i.x=a.x),a.y&&(i.y=a.y)}return i.x=!!i.x,i.y=!!i.y,this.updateAnimation(i),i},_collideSolidBox:function(t){var i=!0,e={x:0,y:0};if(this.overlaps(t)&&(e=this.moveOutside(t)),this.GRAVITY){var s=this.x;this.x=this.lastX,this.standingOn(t)&&(this.stopFalling(),i=!1,"function"==typeof t.stoodOn&&t.stoodOn(this)),this.x=s,i&&(e.x||e.y)&&(App.Utils.almostEqual(this.y,t.y+t.height,1)?(this.yAcceleration<0&&(this.yAcceleration=0),this.yVelocity<0&&(this.yVelocity=0)):(this.jumpDirection.left=!1,this.jumpDirection.right=!1))}return e},updateAnimation:function(t){if(this.src instanceof SpriteMap){var i=this.keys||window.keys,e=this.lastDirection,s=App.Utils.anyIn,n=void 0!==i;n&&void 0!==i.shoot&&s(i.shoot,e)&&(e=this.lastLooked),this.isBeingDragged?this.useAnimation("drag","stand"):this.isInAir()?this.x>this.lastX?this.useAnimation("jumpRight","lookRight","stand"):this.x<this.lastX?this.useAnimation("jumpLeft","lookLeft","stand"):this.isJumping()?this.useAnimation("jump","stand"):this.useAnimation("fall","stand"):this.y>this.lastY?this.x>this.lastX?this.useAnimation("downRight","stand"):this.x<this.lastX?this.useAnimation("downLeft","stand"):this.useAnimation("down","stand"):this.y<this.lastY?this.x>this.lastX?this.useAnimation("upRight","stand"):this.x<this.lastX?this.useAnimation("upLeft","stand"):this.useAnimation("up","stand"):this.x>this.lastX?this.useAnimation("right","stand"):this.x<this.lastX?this.useAnimation("left","stand"):n&&s(i.up,e)?s(i.right,e)?this.useAnimation("lookUpRight","stand"):s(i.left,e)?this.useAnimation("lookUpLeft","stand"):this.useAnimation("lookUp","stand"):n&&s(i.down,e)?s(i.right,e)?this.useAnimation("lookDownRight","stand"):s(i.left,e)?this.useAnimation("lookDownLeft","stand"):this.useAnimation("lookDown","stand"):n&&s(i.right,e)?this.useAnimation(t&&t.x?"right":"lookRight","stand"):n&&s(i.left,e)?this.useAnimation(t&&t.x?"left":"lookLeft","stand"):this.useAnimation("stand")}},useAnimation:function(){if(void 0!==this.src.maps){for(var t=0;t<arguments.length;t++){var i=arguments[t];if(this.src.maps[i])return this.animLoop=i}return!1}},setDraggable:function(t){return this.isDraggable&&t?0:t?App.Events?window.Mouse?(this.isDraggable=!0,this.listen("mousedown.drag touchstart.drag",function(){App.isSomethingBeingDragged=!0,this.isBeingDragged=!0,this.dragStartX=this.x,this.dragStartY=this.y,jQuery(document).trigger("canvasdragstart",[this])}),this.listen("canvasdragstop.drag",function(){this.isBeingDragged=!1;var t=this.collides(this.dropTargets);this.dropTargets.length&&!t?(this.x=this.dragStartX,this.y=this.dragStartY):t&&jQuery(document).trigger("canvasdrop",[t])})):window.console&&console.warn&&console.warn("Actor#setDraggable called, but window.Mouse does not exist."):window.console&&console.warn&&console.warn("Actor#setDraggable called, but App.Events does not exist."):(this.isDraggable=!1,this.unlisten(".drag")),this},getDraggable:function(){return this.isDraggable},release:function(t){var i=this.keys||window.keys;this.GRAVITY&&void 0!==i&&App.Utils.anyIn(i.up,t)&&(this.jumpKeyDown=!1)}}),Player=Actor.extend({MOVEWORLD:.45,JUMP_RELEASE:!0,init:function(){this._super.apply(this,arguments),0<arguments.length&&world.centerViewportAround(this.x,this.y);var t=this;this.__keytracker=function(){jQuery.hotkeys&&t.release([jQuery.hotkeys.lastKeyPressed()])},jQuery(document).on("keyup.release",this.__keytracker)},processInput:function(t){return void 0===t&&jQuery.hotkeys&&(t=jQuery.hotkeys.keysDown),this._super(t)},update:function(t){this._super(t),this.isBeingDragged||this.adjustViewport()},setDraggable:function(t){return t&&!this.isDraggable&&App.Events&&window.Mouse&&this.listen("canvasdragstop.drag",function(){!this.isBeingDragged||this.dropTargets.length&&!this.collides(this.dropTargets)||world.centerViewportAround(this.x,this.y)},-1),this._super.apply(this,arguments)},adjustViewport:function(){var t=world.xOffset,i=world.yOffset,e={x:0,y:0};return window.Mouse&&Mouse.Scroll.isEnabled()?0:(0<t&&this.x+this.width/2-t<canvas.width*this.MOVEWORLD?(world.xOffset=Math.max(t+(this.x-this.lastX),0),context.translate(t-world.xOffset,0),e.x=t-world.xOffset):t<world.width-canvas.width&&this.x+this.width/2-t>canvas.width*(1-this.MOVEWORLD)&&(world.xOffset=Math.min(t+(this.x-this.lastX),world.width-canvas.width),context.translate(t-world.xOffset,0),e.x=t-world.xOffset),0<i&&this.y+this.height/2-i<canvas.height*this.MOVEWORLD?(world.yOffset=Math.max(i+(this.y-this.lastY),0),context.translate(0,i-world.yOffset),e.y=i-world.yOffset):i<world.height-canvas.height&&this.y+this.height/2-i>canvas.height*(1-this.MOVEWORLD)&&(world.yOffset=Math.min(i+(this.y-this.lastY),world.height-canvas.height),context.translate(0,i-world.yOffset),e.y=i-world.yOffset)),e},destroy:function(){this._super.apply(this,arguments),jQuery(document).off(".release",this.__keytracker)}});
//# sourceMappingURL=combined.min.js.map